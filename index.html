<!DOCTYPE html> 
<head>
<meta charset="utf-8" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<style>
div.center {
   text-align: center;
   margin: 5%;
}
body {
  margin-top: 20px;
  background-image: linear-gradient(90deg, #4F364C, #2f202d);
}
.new {
  display: none;
}
</style>
</head>
<body>
<script>
$(document).ready(function(){
	//Загрузить таблицу предметов
	$.getJSON( "https://global.api.pvp.net/api/lol/static-data/ru/v1.2/item?itemListData=into,depth,hideFromAll,requiredChampion,image,tags,maps&api_key=faad7945-0d54-4715-add1-3ee909b5be7b", function( database ) {
	  
	  var clientVersion = database["version"];
	  var items = [];
	  var names = []
	  var boots =[];
	  
	  var banned_items = ["Вестник Зика", "Клятва рыцаря", "Знамя власти", "Искупление", "Кинжал браконьера", "Праведная слава", "Горнило Микаэля", "Омрекер", "Зелье охотника", "Медальон Железных Солари", "Пылающая кадильница", "Вредоносное зелье"]
	  
	  $.each(database["data"], function( itemId, itemInfo ){  
		if (("tags" in itemInfo)&&!(itemInfo["tags"].indexOf("Boots") == -1)&&(itemInfo["depth"] == 2)){
				boots.push(itemId);	
		
		} else {			
            if ((itemInfo["depth"] > 1)&&!("into" in itemInfo)&&(itemInfo["name"].slice(-1) != ")")&&(itemInfo["group"] != "FlaskGroup")&&(itemInfo["maps"]["11"] == true)&&!("requiredChampion" in itemInfo)&&(!("hideFromAll" in itemInfo)||(itemInfo["group"] == "JungleItems"))&&!(itemInfo["name"] in names)){
			    			
				var isValid = 1
				if (itemInfo["tags"]){
			  	for (var i = 0; i < itemInfo["tags"].length; i++) {
				  if ((itemInfo["tags"][i] == "GoldBase")||(itemInfo["tags"][i] == "GoldPer")||(itemInfo["tags"][i] == "Vision")){
				    isValid = 0
				  }
			  	}	
				}
				
				for (var i = 0; i<banned_items.length; i++){
				    if (banned_items[i] == itemInfo["name"]){
					   isValid = 0
					}
				}
			
				if (isValid == 1) {
			  		items.push(itemId);
			  		names.push(itemInfo["name"])
			  		//$(".images").append('<img src="http://ddragon.leagueoflegends.com/cdn/'+ clientVersion + '/img/item/' + database["data"][itemId]["image"]["full"] + '">');
			  		//$(".names").append(database["data"][itemId]["name"] + itemInfo["tags"] + '<br>');
		    	}
			}
		}
	});

	//Будем запоминать группы, чтобы не вышло 2 ботинка или джангл итема
	  var AlreadyUsedGroups = [];
	  var ChosenItems = [];
	  var tags = [];
	  
	  document.getElementById("i").innerHTML = "";
	  
	  
	  //Выберем рандомные предметы
	  var id = 0
	  do {
	  	var chosenItemId = items[Math.floor(Math.random()*items.length)];
		var isGoodItem = false;
		var tagsComp = true;
		
		if (ChosenItems.length == 0)
			chosenItemId = boots[Math.floor(Math.random()*boots.length)];
		
		if (ChosenItems.indexOf(chosenItemId) == -1){
		  
		  if (!("group" in database["data"][chosenItemId])){
			isGoodItem = true;
		  }else{
			var itemGroup = (database["data"][chosenItemId]["group"]);
			if (AlreadyUsedGroups.indexOf(itemGroup) == -1) {
			  isGoodItem = true;
			  AlreadyUsedGroups.push(itemGroup);
			}
		  }
		}
		
		if (isGoodItem){
		  ChosenItems.push(chosenItemId);
		  $(".images").append('<img id="'+ id +'" class="new" src="http://ddragon.leagueoflegends.com/cdn/'+ clientVersion + '/img/item/' + database["data"][chosenItemId]["image"]["full"] + '">');
		  $('#'+(id)).show('fast');
		  id = id+1
		  
		  
		  $(".names").append('<p id="'+ id +'" class="new">'+database["data"][chosenItemId]["name"] + '</p>');
		  $('#'+(id)).show(Math.floor(Math.random()*500)+200, 'swing');
		  id = id+1
		  

			if ("tags" in database["data"][chosenItemId])
			for (var i = 0; i < database["data"][chosenItemId]["tags"].length; i++) {
				tags.push(database["data"][chosenItemId]["tags"][i]); 
			}
		  
		}
	  } while (ChosenItems.length < 7)	
	
	});  
});
</script>
<div class="center">
	<div class="panel panel-default">
		<div class="panel-heading"><h3>Ultimate Bravery: BT Edition</h3></div>
		<div class="panel-body">
			<p>Выкинь один итем. Cобирайся в любом порядке.</p>
			<div class = "images" id="i"><img src="http://preloaders.net/preloaders/39/%D0%92%D0%BE%D1%80%D0%BE%D0%BD%D0%BA%D0%B0.gif"></div>
			<br>
                        <a href="javascript:location.reload(true)" class="btn btn-info btn-lg">
                           <span class="glyphicon glyphicon-refresh"></span> Сменить
                        </a>
			<br><br>
			<div class = "names"></div>
			<br>
		</div>
	</div>
</div>
</body>
